<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        // Enforce trailing slash for correct relative path resolution
        if (window.location.pathname.endsWith('/summit')) {
            window.location.pathname += '/';
        }
    </script>
    <title>Summit Housing Dashboard | Static ML</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=Roboto:wght@300;400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- ONNX Runtime Web -->
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Leaflet.js -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
    <div id="dashboard-container">
        <!-- Sidebar Navigation & Inputs -->
        <aside id="sidebar">
            <header>
                <div class="sidebar-top">
                    <h1>üèîÔ∏è Summit Housing</h1>
                    <div class="header-actions">
                        <button class="icon-btn theme-toggle mobile-only" aria-label="Toggle Theme">
                            <span class="theme-icon">üåô</span>
                        </button>
                        <button id="menu-toggle" class="mobile-only" aria-label="Toggle Menu">
                            <span class="hamburger-icon"></span>
                        </button>
                    </div>
                </div>
                <p>Data Science Project</p>
            </header>

            <nav id="app-nav">
                <button class="nav-item active" data-page="intro">üè† Introduction</button>
                <button class="nav-item" data-page="story">üìä Data Story</button>
                <button class="nav-item" data-page="experiments">üß¨ ML Experiments</button>
                <button class="nav-item" data-page="predictor">üîÆ Price Predictor</button>
            </nav>

            <div class="sidebar-footer desktop-only">
                <button class="icon-btn theme-toggle" style="width: 100%; justify-content: flex-start; gap: 0.75rem;">
                    <span class="theme-icon">üåô</span>
                    <span class="theme-label">Switch Theme</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main id="main-content">

            <section id="intro-page" class="page-section">
                <div class="card full-width hero-card">
                    <h1>üèîÔ∏è Summit County Housing Analysis</h1>
                    <p class="subtitle">A Personal Data Science Project</p>

                    <div class="story-text">
                        <p style="font-size: 1.2rem; margin-bottom: 2rem; color: var(--ink);">
                            What started as curiosity became a full-stack data science exploration.
                        </p>

                        <div class="grid-3" style="margin-bottom: 3rem;">
                            <div class="intro-reason">
                                <strong>üèîÔ∏è Local Context</strong>
                                <p>Understanding the housing market in my area.</p>
                            </div>
                            <div class="intro-reason">
                                <strong>üõ†Ô∏è Data Engineering</strong>
                                <p>Building a production-grade ETL pipeline from raw, messy public records.</p>
                            </div>
                            <div class="intro-reason">
                                <strong>üîÆ ML Inference</strong>
                                <p>Testing the limits of browser-based ML... and my own skillset.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-3 module-guide">
                    <div class="card">
                        <h3>üìä 1. Data Story</h3>
                        <p>Explore the data through interactive visualizations:</p>
                        <ul
                            style="font-size: 0.9rem; color: var(--ink-light); line-height: 1.6; margin-left: 1.2rem; margin-top: 0.5rem;">
                            <li>Distance to ski lifts and resort proximity analysis</li>
                            <li>20+ years of price trends vs. interest rates</li>
                            <li>Buyer origin patterns (local vs. out-of-state)</li>
                            <li>Seasonal purchase patterns and market cycles</li>
                            <li>Raw property data samples with 20+ attributes</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>üß¨ 2. ML Experiments</h3>
                        <p>Dive into the model development process:</p>
                        <ul
                            style="font-size: 0.9rem; color: var(--ink-light); line-height: 1.6; margin-left: 1.2rem; margin-top: 0.5rem;">
                            <li>Tournament leaderboard comparing 10+ model runs</li>
                            <li>Gradient Boosting vs. Neural Network performance</li>
                            <li>SHAP values showing feature importance</li>
                            <li>Partial Dependence Plots for all numeric features</li>
                            <li>Model selection and version comparison tools</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>üîÆ 3. Price Predictor</h3>
                        <p>Test the model with your own scenarios:</p>
                        <ul
                            style="font-size: 0.9rem; color: var(--ink-light); line-height: 1.6; margin-left: 1.2rem; margin-top: 0.5rem;">
                            <li>Interactive "What-If" simulator with real-time predictions</li>
                            <li>Adjust property features (size, beds, location, etc.)</li>
                            <li>Runs entirely in your browser using ONNX Runtime</li>
                            <li>Compare predictions across different model versions</li>
                            <li>No backend required‚Äîpure client-side ML inference</li>
                        </ul>
                    </div>
                </div>

                <div class="card full-width tech-guide">
                    <h3>üõ†Ô∏è How to use the Product</h3>
                    <p>This platform is built for continuous iteration. You can trigger the core workflows from the
                        terminal:</p>
                    <div class="grid-3">
                        <div class="code-box">
                            <strong>1. Data Collection</strong>
                            <code>make scrape</code>
                            <p class="caption">Runs the asynchronous scraper to pull the latest property records.</p>
                        </div>
                        <div class="code-box">
                            <strong>2. ETL Pipeline</strong>
                            <code>make ingest</code>
                            <p class="caption">Resets the local SQLite warehouse and performs complex SQL feature
                                engineering.</p>
                        </div>
                        <div class="code-box">
                            <strong>3. Model Training</strong>
                            <code>make tournament</code>
                            <p class="caption">Triggers a parameter sweep tournament. The best model is promoted.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="predictor-page" class="page-section hidden">
                <header id="metrics-banner">
                    <div class="metric-card">
                        <span class="label">ACTIVE MODEL</span>
                        <span id="active-model-name" class="value">Gradient Boosting</span>
                    </div>
                    <div id="prediction-metric" class="metric-card highlight">
                        <span class="label">ESTIMATED VALUE</span>
                        <span id="estimated-price" class="value">$0</span>
                        <span id="last-updated" class="metric-timestamp"></span>
                    </div>
                    <div class="metric-card">
                        <span class="label">MODEL MAE</span>
                        <span id="model-mae" class="value">$458,184</span>
                    </div>
                </header>

                <div class="predictor-layout">
                    <aside id="predictor-controls" class="card">
                        <!-- Row 0: Presets -->
                        <div class="controls-section">
                            <h4>‚ö° Quick Presets</h4>
                            <div class="preset-group">
                                <span class="preset-label">Property:</span>
                                <div class="preset-buttons">
                                    <button class="preset-btn" onclick="applyPreset('condo')">üè¢ Condo</button>
                                    <button class="preset-btn" onclick="applyPreset('family')">üè° Family</button>
                                    <button class="preset-btn" onclick="applyPreset('luxury')">üíé Luxury</button>
                                </div>
                            </div>
                            <div class="preset-group" style="margin-top: 8px;">
                                <span class="preset-label">Market:</span>
                                <div class="preset-buttons">
                                    <button class="preset-btn" onclick="applyPreset('2021')">üöÄ '21 Boom</button>
                                    <button class="preset-btn" onclick="applyPreset('curr')">‚öñÔ∏è Current</button>
                                    <button class="preset-btn" onclick="applyPreset('high_rate')">üìâ Stress</button>
                                    <button class="preset-btn" onclick="applyPreset('ai_deflation')">ü§ñ AI
                                        Deflation</button>
                                </div>
                            </div>
                        </div>

                        <!-- Row 1: Current Model -->
                        <div class="controls-section">
                            <h4>üß† Current Model</h4>
                            <div class="controls-grid">
                                <div class="control-group">
                                    <label>Model Architecture</label>
                                    <div class="radio-group">
                                        <label><input type="radio" name="model-choice" value="gbm" checked> GBM</label>
                                        <label><input type="radio" name="model-choice" value="nn"> NN</label>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label>Model Version</label>
                                    <select id="input-model-version">
                                        <option>Loading...</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Row 2: House Properties -->
                        <div class="controls-section">
                            <h4>üè† House Properties</h4>
                            <div class="controls-grid">

                                <div class="control-group">
                                    <label>SqFt</label>
                                    <input type="number" id="val-sfla" value="1500">
                                    <input type="range" id="input-sfla" min="400" max="10000" value="1500" step="50">
                                </div>

                                <div class="control-group">
                                    <label>Beds / Baths</label>
                                    <div class="grid-2" style="gap: 10px;">
                                        <input type="number" id="input-beds" value="2" min="0" max="10">
                                        <input type="number" id="input-baths" value="2" min="1" max="10" step="0.5">
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label>Built</label>
                                    <input type="number" id="input-year" value="1995" min="1900" max="2025">
                                </div>

                                <div class="control-group">
                                    <label>Property Type</label>
                                    <select id="input-type">
                                        <option value="Single Family">Single Family</option>
                                        <option value="Condo">Condo</option>
                                        <option value="Townhouse">Townhouse</option>
                                        <option value="Duplex-Triplex">Duplex / Triplex</option>
                                        <option value="Vacant Land">Vacant Land</option>
                                    </select>
                                </div>

                                <div class="control-group">
                                    <label>Location</label>
                                    <select id="input-city">
                                        <option value="BRECKENRIDGE">Breckenridge</option>
                                        <option value="FRISCO">Frisco</option>
                                        <option value="SILVERTHORNE">Silverthorne</option>
                                        <option value="DILLON">Dillon</option>
                                        <option value="KEYSTONE">Keystone</option>
                                        <option value="COPPER MOUNTAIN">Copper Mountain</option>
                                    </select>
                                </div>

                                <div class="control-group">
                                    <label>Grade</label>
                                    <select id="input-grade">
                                        <option value="6">Luxury</option>
                                        <option value="5">Custom</option>
                                        <option value="4" selected>Average</option>
                                        <option value="3">Economy</option>
                                    </select>
                                </div>

                                <div class="control-group">
                                    <label>View (0-5)</label>
                                    <input type="number" id="input-view" min="0" max="5" value="0">
                                </div>

                                <div class="control-group">
                                    <label>Lot Size (Acres)</label>
                                    <input type="number" id="input-acres" value="0.1" step="0.05" min="0">
                                </div>
                                <div class="control-group">
                                    <label>Garage (SqFt)</label>
                                    <input type="number" id="input-garage" value="500" step="50" min="0">
                                </div>
                                <div class="control-group">
                                    <label>Condition</label>
                                    <select id="input-cond">
                                        <option value="6">Excellent</option>
                                        <option value="5">Good</option>
                                        <option value="4" selected>Average</option>
                                        <option value="3">Fair</option>
                                        <option value="2">Poor</option>
                                    </select>
                                </div>

                                <div class="control-group">
                                    <label>Dist. to Lift (miles)</label>
                                    <input type="number" id="val-dist-lift" value="0.5" step="0.1">
                                    <input type="range" id="input-dist-lift" min="0" max="20" value="0.5" step="0.1">
                                </div>
                            </div>
                        </div>

                        <!-- Row 3: Macro-Economic Conditions -->
                        <div class="controls-section">
                            <h4>üìà Macro-Economic Conditions</h4>
                            <div class="controls-grid">
                                <div class="control-group">
                                    <label>Rate (%)</label>
                                    <input type="number" id="val-rate" value="6.5" step="0.1">
                                    <input type="range" id="input-rate" min="2.0" max="10.0" value="6.5" step="0.1">
                                </div>

                                <div class="control-group">
                                    <label>CPI (Inflation)</label>
                                    <input type="number" id="val-cpi" value="310">
                                    <input type="range" id="input-cpi" min="150" max="400" value="310" step="1">
                                </div>
                                <div class="control-group">
                                    <label>S&P 500</label>
                                    <input type="number" id="val-sp500" value="6950">
                                    <input type="range" id="input-sp500" min="2000" max="9000" value="6950" step="10">
                                </div>
                                <div class="control-group">
                                    <label>County Pop. (k)</label>
                                    <input type="number" id="val-pop" value="31">
                                    <input type="range" id="input-pop" min="20" max="50" value="31" step="0.5">
                                </div>
                            </div>
                        </div>
                    </aside>

                    <div class="predictor-content">
                        <div class="card full-width">
                            <div id="main-chart" style="height: 400px;"></div>
                        </div>

                        <div class="card full-width">
                            <h4>üß† AI Explainer (Local Feature Contributions)</h4>
                            <p class="caption">This chart shows how each feature pulls the predicted price away from the
                                county average.</p>
                            <div id="chart-shap" style="height: 400px;"></div>
                        </div>

                        <div class="card full-width">
                            <h4>Recent Sales (Comps)</h4>
                            <p class="caption">The exact data rows that are most similar to your input, from the sample
                                dataset.</p>
                            <div id="comps-container" class="comps-grid">
                                <!-- Comps injected here -->
                                <p class="text-muted" style="padding: 20px;">Loading comparable sales...</p>
                            </div>
                        </div>

                        <div class="grid-2">
                            <div class="card">
                                <h3>Sensitivity: Square Footage</h3>
                                <div id="chart-sqft" style="height: 300px;"></div>
                            </div>
                            <div class="card">
                                <h3>Sensitivity: Mortgage Rate</h3>
                                <div id="chart-rates" style="height: 300px;"></div>
                            </div>
                        </div>



                    </div>
                </div>
            </section>

            <section id="story-page" class="page-section hidden">
                <div class="card full-width">
                    <div class="story-header">
                        <div class="scrolly-progress-container">
                            <div id="scrolly-progress-bar" class="scrolly-progress-bar"></div>
                        </div>
                        <h2>Summit County Housing Data Story</h2>
                        <p class="story-text">Exploring publicly available data to understand the housing market in
                            Summit
                            County, Colorado.</p>
                    </div>

                    <div class="scrolly-container">
                        <!-- Narrative Side -->
                        <div class="scrolly-narrative">
                            <div class="scrolly-step active" data-step="landscape">
                                <div class="card">
                                    <h3>üìç The Landscape</h3>
                                    <p>Summit County, Colorado is a high-altitude destination, where skiing and
                                        mountain
                                        living are primary drivers of the economy. Click the map to identify the
                                        county
                                        hotspots and landmarks.</p>
                                </div>
                                <div id="mobile-viz-landscape" class="mobile-viz-placeholder"></div>
                            </div>

                            <div class="scrolly-step" data-step="ski-lift">
                                <div class="card">
                                    <h3>‚ùÑÔ∏è The "Ski Lift Effect"</h3>
                                    <p>Ski-in/ski-out properties are marketed to tourists and second-home owners.
                                        It feels intuitive that these properties command a premium, but is worth
                                        quantifying.
                                        This map shows every residential parcel's distance to its nearest chairlift.</p>
                                </div>
                                <div id="mobile-viz-ski-lift" class="mobile-viz-placeholder"></div>
                            </div>

                            <div class="scrolly-step" data-step="market-cycles">
                                <div class="card">
                                    <h3>üìà Market Cycles</h3>
                                    <p>Mortgage rates impact the cost of borrowing to purchase a home. We compared 20
                                        years of price action against the Fed
                                        Funds rate.</p>
                                    <div class="card-action-bar">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="story-toggle-market-aggregate" checked>
                                            <span class="slider"></span>
                                            <span class="toggle-label">County Aggregate</span>
                                        </label>
                                    </div>
                                </div>
                                <div id="mobile-viz-market-cycles" class="mobile-viz-placeholder"></div>
                            </div>

                            <div class="scrolly-step" data-step="buyer-origins">
                                <div class="card">
                                    <h3>üè† Who is Buying?</h3>
                                    <p>Ownership records provide a mailing address, which I use as a proxy for the
                                        buyer's home base. We track the shift between locals, in-state buyers, and
                                        out-of-state investors.</p>
                                    <div class="card-action-bar">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="story-toggle-buyer-percentage">
                                            <span class="slider"></span>
                                            <span class="toggle-label">Show as %</span>
                                        </label>
                                    </div>
                                </div>
                                <div id="mobile-viz-buyer-origins" class="mobile-viz-placeholder"></div>
                            </div>

                            <div class="scrolly-step" data-step="seasonality">
                                <div class="card">
                                    <h3>üå°Ô∏è Seasonal Pulse</h3>
                                    <p>Housing oftens sells seasonally and Summit County is no exception. This heatmap
                                        shows the number of sales by month and town.</p>
                                </div>
                                <div id="mobile-viz-seasonality" class="mobile-viz-placeholder"></div>
                            </div>

                            <div class="scrolly-step" data-step="supply">
                                <div class="card">
                                    <h3>üèóÔ∏è Supply & Density</h3>
                                    <p>There's a narrative right now that home prices are high due to supply
                                        constraints.
                                        Let's dig into that.</p>
                                </div>
                                <div id="mobile-viz-supply" class="mobile-viz-placeholder"></div>
                            </div>

                            <div class="scrolly-step" data-step="deep-dive">
                                <div class="card">
                                    <h3>üîç Deep Dive: The Data Explorer</h3>
                                    <p>This is a sample of the raw data that powers this analysis. You have the option
                                        to view a subset of columns, or all of them.</p>
                                </div>
                                <div id="mobile-viz-deep-dive" class="mobile-viz-placeholder"></div>
                            </div>
                        </div>

                        <!-- Sticky Visualization Side -->
                        <div class="scrolly-viz-panel">
                            <div class="scrolly-viz-container">
                                <div id="scrolly-viz-target" style="height: 100%; width: 100%;">
                                    <!-- Charts/Maps will be moved here by JS -->
                                    <div id="map-hotspots" style="height: 100%; width: 100%;"></div>
                                    <div id="distance-map" class="hidden" style="height: 100%; width: 100%;"></div>
                                    <div id="chart-market-trends" class="hidden" style="height: 100%; width: 100%;">
                                    </div>
                                    <div id="chart-buyer-origins" class="hidden" style="height: 100%; width: 100%;">
                                    </div>
                                    <div id="chart-seasonality" class="hidden" style="height: 100%; width: 100%;"></div>
                                    <div id="chart-supply" class="hidden" style="height: 100%; width: 100%;"></div>
                                    <div id="scrolly-data-explorer" class="hidden" style="height: 100%; width: 100%;">
                                        <div class="table-container" style="height: 100%; overflow-y: auto;">
                                            <table id="scrolly-property-table" class="data-table">
                                                <thead>
                                                    <!-- Table headers will be injected -->
                                                </thead>
                                                <tbody>
                                                    <!-- Data will be injected -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div id="scrolly-viz-overlay" class="scrolly-viz-overlay">üìç Points of Interest</div>
                            </div>
                        </div>
                    </div>

                    <!-- Utilities (kept full width below the story) -->
                    <div id="market-overview-metrics" class="metrics-banner" style="margin-top: 4rem;">
                        <!-- Populated by JS -->
                    </div>

                    <div class="card full-width" style="margin-top: 2rem;">

                        <!-- Model Feature Selection & Training Safeguards -->
                        <div class="grid-2">
                            <div class="card">
                                <h3>üõ†Ô∏è Model Feature Selection</h3>
                                <div class="meta-grid">
                                    <div class="meta-item safe">
                                        <strong>‚úÖ INCLUDED</strong>
                                        Structure, Quality, Location, Macro
                                    </div>
                                    <div class="meta-item alert">
                                        <strong>‚ùå EXCLUDED</strong>
                                        Tax Values, Trans. Date, Address
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <h3>üß† Training Safeguards</h3>
                                <ul>
                                    <li>Time-Based Split (No leakage)</li>
                                    <li>Log-Space Target Transformation</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Correlation Matrix -->
                        <div class="card full-width">
                            <h3>üìä Correlation Matrix</h3>
                            <p class="caption">Click any cell to drill down into the underlying relationship.</p>
                            <div id="chart-correlations" style="height: 500px;"></div>
                        </div>

                        <!-- Correlation Drill-down -->
                        <div id="correlation-drilldown" class="card full-width hidden">
                            <div class="row header-row" style="justify-content: space-between; align-items: center;">
                                <h3 id="drilldown-title">Correlation Drill-down</h3>
                                <button class="icon-btn"
                                    onclick="document.getElementById('correlation-drilldown').classList.add('hidden')">‚úï</button>
                            </div>
                            <div id="chart-correlation-drilldown" style="height: 400px;"></div>
                            <p class="caption">Analyzing the relationship between <span id="drilldown-var-x"></span> and
                                <span id="drilldown-var-y"></span>.
                            </p>
                        </div>
            </section>

            <section id="experiments-page" class="page-section hidden">
                <div class="card full-width">
                    <h2>üß¨ ML Experiment Registry</h2>
                    <p>Training history and model convergence metrics.</p>
                    <div id="leaderboard-container">
                        <table id="leaderboard">
                            <thead>
                                <tr>
                                    <th>Run ID</th>
                                    <th>Model</th>
                                    <th>MAE</th>
                                    <th>R2</th>
                                    <th>Status</th>
                                    <th style="width: 50px;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Model Detail View (shown when a model is clicked) -->
                <div id="model-detail-view" class="hidden">
                    <div class="card full-width">
                        <h3 id="model-detail-title">Model Interpretability</h3>
                        <p class="story-text">Understanding what drives predictions for this model.</p>
                    </div>

                    <!-- SHAP Feature Importance -->
                    <div class="card full-width">
                        <h4>SHAP Feature Importance</h4>
                        <div id="chart-shap-experiments" style="height: 400px;"></div>
                        <p class="caption">The top features driving price decisions across the entire model.</p>
                    </div>

                    <!-- Partial Dependence Plot -->
                    <div class="card full-width">
                        <div class="row header-row" style="justify-content: space-between; margin-bottom: 1rem;">
                            <h4>Partial Dependence (Marginal Effect)</h4>
                            <div class="control-group" style="max-width: 200px;">
                                <select id="pdp-feature-select-experiments" class="metric-select">
                                    <option value="">Loading features...</option>
                                </select>
                            </div>
                        </div>
                        <div id="chart-pdp-experiments" style="height: 400px;"></div>
                        <p class="caption">How specific features impact price, holding others constant.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer
        style="text-align: center; padding: 2rem 1rem; color: var(--ink-light); font-size: 0.85rem; border-top: 1px solid var(--border);">
        <p style="margin: 0;">
            Summit Housing Dashboard ‚Ä¢ Data from <span id="last-updated-footer">Loading...</span>
        </p>
    </footer>

    <script src="dashboard.js"></script>
</body>

</html>